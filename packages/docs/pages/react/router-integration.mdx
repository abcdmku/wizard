# Router Integration

Learn how to integrate wizards with popular React routing libraries for URL-based navigation and bookmarkable steps.

import { Callout, Tabs, Tab } from '../../components'

## Overview

Router integration enables:
- **URL syncing** - Wizard steps reflected in the browser URL
- **Bookmarkable steps** - Users can bookmark and share wizard URLs
- **Deep linking** - Direct navigation to specific steps
- **Browser history** - Back/forward buttons work naturally
- **Route guards** - Validate step access and permissions

## TanStack Router (Recommended)

The `@wizard/react` package provides first-class integration with TanStack Router through the `createWizardRouteComponent` helper.

### Quick Start

```tsx
import { createWizardRouteComponent } from '@wizard/react';
import { createRouter, createRoute } from '@tanstack/react-router';
import { wizard } from './wizard/config';

// Create wizard route component
const WizardRoute = createWizardRouteComponent({
  wizard,
  basePath: '/checkout'
});

// Set up routes
const checkoutRoute = createRoute({
  path: '/checkout',
  component: WizardRoute
});

const router = createRouter({
  routes: [checkoutRoute]
});
```

The wizard automatically:
- Syncs step with URL (`/checkout/account`, `/checkout/shipping`, etc.)
- Updates URL on navigation
- Restores step from URL on page load
- Validates step exists before navigating
- Handles browser back/forward buttons

### URL Structure

The wizard creates clean, SEO-friendly URLs:

```
/checkout/account      → Account information step
/checkout/shipping     → Shipping details step
/checkout/payment      → Payment information step
/checkout/review       → Order review step
```

<Callout type="tip">
Use descriptive step IDs as they become part of your URL structure. Instead of `step1`, `step2`, use `account`, `shipping`, etc.
</Callout>

### Custom Step Rendering

You can customize how each step renders:

```tsx
const WizardRoute = createWizardRouteComponent({
  wizard,
  basePath: '/checkout',
  renderStep: ({ step, data, actions }) => {
    // Render different components based on step
    switch (step) {
      case 'account':
        return <AccountStep data={data} {...actions} />;
      case 'shipping':
        return <ShippingStep data={data} {...actions} />;
      case 'payment':
        return <PaymentStep data={data} {...actions} />;
      default:
        return <div>Unknown step</div>;
    }
  }
});
```

## React Router

For React Router v6+, you can manually sync wizard state with the URL:

```tsx
import { useNavigate, useParams } from 'react-router-dom';
import { useWizard } from '@wizard/react';
import { useEffect } from 'react';
import { wizard } from './wizard/config';

function WizardPage() {
  const { step } = useParams<{ step: string }>();
  const navigate = useNavigate();
  const { state, goTo, subscribe } = useWizard(wizard);

  // Sync wizard step with URL param
  useEffect(() => {
    if (step && step !== state.currentStep) {
      goTo(step).catch(() => {
        // Invalid step, redirect to first step
        navigate('/wizard/account', { replace: true });
      });
    }
  }, [step, state.currentStep]);

  // Update URL when wizard step changes
  useEffect(() => {
    const unsubscribe = subscribe((newState) => {
      if (newState.currentStep !== step) {
        navigate(`/wizard/${newState.currentStep}`, { replace: true });
      }
    });
    return unsubscribe;
  }, [step]);

  return <WizardStepRenderer />;
}
```

### Route Configuration

```tsx
import { Routes, Route } from 'react-router-dom';

function App() {
  return (
    <Routes>
      <Route path="/wizard/:step" element={<WizardPage />} />
      <Route path="/wizard" element={<Navigate to="/wizard/account" />} />
    </Routes>
  );
}
```

## Next.js App Router

For Next.js 13+ with App Router:

```tsx
// app/wizard/[step]/page.tsx
'use client';

import { useParams, useRouter } from 'next/navigation';
import { useWizard } from '@wizard/react';
import { useEffect } from 'react';
import { wizard } from '@/wizard/config';

export default function WizardStepPage() {
  const params = useParams();
  const router = useRouter();
  const { state, goTo } = useWizard(wizard);
  const step = params.step as string;

  useEffect(() => {
    if (step && step !== state.currentStep) {
      goTo(step).catch(() => {
        router.replace('/wizard/account');
      });
    }
  }, [step, state.currentStep]);

  return <WizardStepRenderer />;
}
```

## Next.js Pages Router

For Next.js with Pages Router:

```tsx
// pages/wizard/[step].tsx
import { useRouter } from 'next/router';
import { useWizard } from '@wizard/react';
import { useEffect } from 'react';
import { wizard } from '@/wizard/config';

export default function WizardPage() {
  const router = useRouter();
  const { step } = router.query;
  const { state, goTo } = useWizard(wizard);

  useEffect(() => {
    if (step && step !== state.currentStep) {
      goTo(step as string).catch(() => {
        router.replace('/wizard/account');
      });
    }
  }, [step, state.currentStep]);

  return <WizardStepRenderer />;
}
```

## Route Guards

Protect wizard steps with route guards to ensure users follow the correct flow:

### TanStack Router

```tsx
const checkoutRoute = createRoute({
  path: '/checkout/$step',
  beforeLoad: async ({ params, context }) => {
    const { step } = params;

    // Check if step exists
    if (!wizard.helpers.hasStep(step)) {
      throw redirect({ to: '/checkout/account' });
    }

    // Check if step is accessible
    const canEnter = await wizard.helpers.canEnterStep(step);
    if (!canEnter) {
      throw redirect({ to: '/checkout/account' });
    }

    return { step };
  },
  component: WizardRoute
});
```

### React Router

```tsx
function ProtectedWizardRoute() {
  const { step } = useParams();
  const navigate = useNavigate();
  const { helpers } = useWizard(wizard);

  useEffect(() => {
    if (!step || !helpers.hasStep(step)) {
      navigate('/wizard/account', { replace: true });
      return;
    }

    helpers.canEnterStep(step).then((canEnter) => {
      if (!canEnter) {
        navigate('/wizard/account', { replace: true });
      }
    });
  }, [step]);

  return <WizardPage />;
}
```

## Query Parameters

Preserve query parameters alongside wizard navigation:

```tsx
// TanStack Router
const WizardRoute = createWizardRouteComponent({
  wizard,
  basePath: '/checkout',
  preserveQueryParams: true
});

// Example: /checkout/shipping?promo=SAVE20
// Query params are preserved when navigating between steps
```

For manual implementations, use your router's query parameter APIs:

```tsx
// React Router
navigate(`/wizard/${nextStep}?${searchParams.toString()}`);

// Next.js
router.push(`/wizard/${nextStep}?${router.query.toString()}`);
```

## Best Practices

### Use Descriptive Step IDs

```tsx
// ✅ Good - clear URLs
defineSteps({
  account: step({ ... }),
  shipping: step({ ... }),
  payment: step({ ... })
});
// URLs: /checkout/account, /checkout/shipping, /checkout/payment

// ❌ Bad - unclear URLs
defineSteps({
  step1: step({ ... }),
  step2: step({ ... }),
  step3: step({ ... })
});
// URLs: /checkout/step1, /checkout/step2, /checkout/step3
```

### Handle Invalid Steps

Always handle cases where users navigate to invalid steps:

```tsx
goTo(step).catch(() => {
  // Redirect to first step or error page
  navigate('/wizard/account', { replace: true });
});
```

### Consider SEO

For public wizards, add appropriate meta tags per step:

```tsx
function WizardStepPage() {
  const { step } = useParams();

  return (
    <>
      <Head>
        <title>{getStepTitle(step)} | Checkout</title>
        <meta name="description" content={getStepDescription(step)} />
      </Head>
      <WizardStepRenderer />
    </>
  );
}
```

### Handle Browser Back Button

The router integration automatically handles browser back/forward buttons. For manual implementations, ensure your URL sync logic handles this:

```tsx
useEffect(() => {
  const handlePopState = () => {
    // URL changed via back/forward button
    const newStep = getStepFromUrl();
    if (newStep !== state.currentStep) {
      goTo(newStep);
    }
  };

  window.addEventListener('popstate', handlePopState);
  return () => window.removeEventListener('popstate', handlePopState);
}, [state.currentStep]);
```

## Examples

- [TanStack Router Integration](/examples/react-router) - Complete example with URL syncing
- [Multi-page Forms](/patterns#multi-page-forms-with-router) - Pattern documentation

## Next Steps

- Learn about [React Hooks](/react/hooks) for wizard state management
- See [Examples](/examples) for complete implementations
- Explore [Validation](/validation) for form validation
