# `@wizard/core` API

Source of truth: `packages/core/src/index.ts`

## Canonical Authoring Pattern

```ts
import { createWizardFactory } from '@wizard/core';

type Context = { userId?: string };

const factory = createWizardFactory<Context, Error>();
const { defineSteps, step } = factory;

const steps = defineSteps({
  account: step({
    data: { email: '' },
    next: ['review'],
    validate: ({ data }) => {
      if (!data.email.includes('@')) throw new Error('Invalid email');
    },
  }),
  review: step<{ confirmed: boolean }, TypeError>({
    data: { confirmed: false },
    next: [],
  }),
});

export const wizard = factory.createWizard(steps, {
  context: {},
});
```

## Migration Note

`createWizardFactory` generic order is now:

- New: `createWizardFactory<Context, DefaultError, Event>()`
- Old: `createWizardFactory<Context, Event, DefaultError>()`

This is a breaking change. Update old 3-generic calls accordingly.

## Runtime API

- `createWizard(opts)`
- `createWizardFactory<C, DefaultError, E>()`
- `defineSteps(defs)`
- `step(definition)`
- `stepWithValidation(validateFn, definition)`
- `resolve(valueOrFn, args)`
- `resolveMetaCore(meta, args)`

## Step Typing

Factory step typing:

```ts
const factory = createWizardFactory<{ locale: 'en' | 'fr' }, Error>();

const steps = factory.defineSteps({
  account: factory.step({
    data: { email: '' },
    next: ['review'],
  }),
  review: factory.step<{ agreed: boolean }, TypeError>({
    data: { agreed: false },
    next: [],
  }),
});
```

`Data` is inferred automatically from `data` (or `validate`), so you usually do not need `step<Data>(...)`.
Only specify `Data` explicitly when needed, for example when also overriding `StepError`.

Standalone helper typing (generic order differs):

```ts
import { step } from '@wizard/core';

const account = step<{ email: string }, { locale: string }, TypeError>({
  data: { email: '' },
  next: [],
});
```

Helper order is `step<Data, Context, StepError>`, while factory order is `step<Data, StepError>`.

## Compatibility-focused exports

The following exports are retained for migration and compatibility paths. Prefer the canonical types and factory-first authoring pattern for new code.

- `WizardConfig`
- `WizardTransitionEvent`
- `WizardPersistence`
- `InferContext`
- `InferSteps`
- `InferDataMap`
- `EnhancedWizard`
- `EnhancedDataMapFromDefs`
- `StepRuntime`

## Removed APIs

- `wizardWithContext` is removed.
- `dataStep`, `transitionStep`, and `conditionalStep` are removed.

## Exhaustive Exports (Auto-Synced)

{/* AUTO-EXPORTS:START */}
Generated from package entrypoint exports via `scripts/sync-api-reference.mjs`.
| Symbol | Kind | Category |
| --- | --- | --- |
| `createWizard` | `value` | Runtime |
| `createWizardFactory` | `value` | Runtime |
| `defineSteps` | `value` | Runtime |
| `resolve` | `value` | Runtime |
| `resolveMetaCore` | `value` | Runtime |
| `step` | `value` | Runtime |
| `stepWithValidation` | `value` | Runtime |
| `CreateWizardOptions` | `type` | Primary types |
| `DataMapFromDefs` | `type` | Primary types |
| `DataTypeOf` | `type` | Primary types |
| `ErrorMapFromDefs` | `type` | Primary types |
| `ErrorTypeOf` | `type` | Primary types |
| `JSONValue` | `type` | Primary types |
| `PartialStepDefinition` | `type` | Primary types |
| `StepArgs` | `type` | Primary types |
| `StepDefinition` | `type` | Primary types |
| `StepEnterArgs` | `type` | Primary types |
| `StepExitArgs` | `type` | Primary types |
| `StepIds` | `type` | Primary types |
| `StepMetaCore` | `type` | Primary types |
| `StepStatus` | `type` | Primary types |
| `ValidateArgs` | `type` | Primary types |
| `ValOrFn` | `type` | Primary types |
| `WithDataBrand` | `type` | Primary types |
| `WithErrorBrand` | `type` | Primary types |
| `Wizard` | `type` | Primary types |
| `WizardHelpers` | `type` | Primary types |
| `WizardState` | `type` | Primary types |
| `WizardStep` | `type` | Primary types |
| `EnhancedDataMapFromDefs` | `type` | Compatibility aliases |
| `EnhancedWizard` | `type` | Compatibility aliases |
| `InferContext` | `type` | Compatibility aliases |
| `InferDataMap` | `type` | Compatibility aliases |
| `InferStepData` | `type` | Compatibility aliases |
| `InferSteps` | `type` | Compatibility aliases |
| `StepRuntime` | `type` | Compatibility aliases |
| `WizardConfig` | `type` | Compatibility aliases |
| `WizardPersistence` | `type` | Compatibility aliases |
| `WizardTransitionEvent` | `type` | Compatibility aliases |
{/* AUTO-EXPORTS:END */}
