# Advanced Branching Example

import { Callout } from '../../components'

A comprehensive example demonstrating dynamic navigation, role-based step visibility, and conditional branching in a wizard flow.

## Overview

This example shows how to build wizards with:
- **Dynamic step paths** that change based on user input
- **Role-based access control** for different user types
- **Conditional branching** with approval workflows
- **Step guards** using `canEnter` functions
- **Visual path indicators** showing available steps

## What You'll Learn

<div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '1rem', marginTop: '1.5rem' }}>
  <div style={{ padding: '1rem', border: '1px solid var(--gray-300)', borderRadius: '8px' }}>
    <div style={{ fontWeight: 600, marginBottom: '0.5rem' }}>ğŸ”€ Dynamic Routing</div>
    <div style={{ fontSize: '0.9rem', opacity: 0.8 }}>Build flows that adapt based on user choices</div>
  </div>
  <div style={{ padding: '1rem', border: '1px solid var(--gray-300)', borderRadius: '8px' }}>
    <div style={{ fontWeight: 600, marginBottom: '0.5rem' }}>ğŸ” Access Control</div>
    <div style={{ fontSize: '0.9rem', opacity: 0.8 }}>Restrict steps based on user roles</div>
  </div>
  <div style={{ padding: '1rem', border: '1px solid var(--gray-300)', borderRadius: '8px' }}>
    <div style={{ fontWeight: 600, marginBottom: '0.5rem' }}>âœ… Approval Flows</div>
    <div style={{ fontSize: '0.9rem', opacity: 0.8 }}>Add conditional approval steps</div>
  </div>
</div>

## User Flows

The wizard implements three distinct paths based on role selection:

### User Flow
**Role Selection** â†’ **User Profile** â†’ **Review**

Simple path for regular users with basic profile information.

### Admin Flow
**Role Selection** â†’ **Admin Panel** â†’ **Review**

Or with approval:
**Role Selection** â†’ **Admin Panel** â†’ **Manager Dashboard** â†’ **Review**

Admins can optionally trigger a manager approval flow.

### Manager Flow
**Role Selection** â†’ **Manager Dashboard** â†’ **Review**

Direct access to manager-specific features.

## Key Implementation

### Wizard Factory

First, create the factory with typed context:

```typescript file="@examples/advanced-branching/src/wizard/factory.ts"
```

### Wizard Configuration

Then define the steps with dynamic navigation and guards:

```typescript file="@examples/advanced-branching/src/wizard/config.ts" lines="41-85"
```

### Navigation Logic

The navigation module handles dynamic step routing based on roles:

```typescript file="@examples/advanced-branching/src/wizard/navigation.ts"
```

### React Component

```tsx
import { WizardProvider, useWizard, useWizardState } from '@wizard/react';
import { wizard } from './wizard/config';
import { getAvailableStepsForRole } from './wizard/navigation';

function App() {
  return (
    <WizardProvider wizard={wizard}>
      <WizardFlow />
    </WizardProvider>
  );
}

function WizardFlow() {
  const wizardInstance = useWizard();
  const { step, context } = useWizardState();

  const availableSteps = getAvailableStepsForRole(context.role);

  return (
    <div>
      {/* Step indicator showing available steps */}
      <StepNavigator
        currentStep={step}
        availableSteps={availableSteps}
        role={context.role}
      />

      {/* Render current step */}
      {step === 'roleSelection' && <RoleSelection />}
      {step === 'userProfile' && <UserProfile />}
      {step === 'adminPanel' && <AdminPanel />}
      {step === 'managerDashboard' && <ManagerDashboard />}
      {step === 'review' && <Review />}

      {/* Navigation buttons */}
      <div className="navigation">
        <button
          onClick={() => wizardInstance.back()}
          disabled={!wizardInstance.helpers.canGoBack()}
        >
          Back
        </button>
        <button
          onClick={() => wizardInstance.next()}
          disabled={!wizardInstance.helpers.canGoNext()}
        >
          Next
        </button>
      </div>
    </div>
  );
}
```

## Running the Example

```bash
# From repository root
cd examples/advanced-branching

# Install dependencies
pnpm install

# Start development server
pnpm dev

# Build for production
pnpm build
```

## Project Structure

```
src/
â”œâ”€â”€ App.tsx                    # Main app component (12 lines)
â”œâ”€â”€ wizard/
â”‚   â”œâ”€â”€ config.ts              # Wizard configuration
â”‚   â”œâ”€â”€ factory.ts             # Wizard factory with types
â”‚   â”œâ”€â”€ types.ts               # TypeScript types
â”‚   â””â”€â”€ navigation.ts          # Dynamic routing logic
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ steps/
â”‚   â”‚   â”œâ”€â”€ RoleSelection.tsx  # Role selection step
â”‚   â”‚   â”œâ”€â”€ UserProfile.tsx    # User-only step
â”‚   â”‚   â”œâ”€â”€ AdminPanel.tsx     # Admin-only step
â”‚   â”‚   â”œâ”€â”€ ManagerDashboard.tsx # Manager step
â”‚   â”‚   â””â”€â”€ Review.tsx         # Final review step
â”‚   â”œâ”€â”€ ui/
â”‚   â”‚   â”œâ”€â”€ RoleBadge.tsx      # Shows current role
â”‚   â”‚   â””â”€â”€ StepNavigator.tsx  # Dynamic step indicator
â”‚   â””â”€â”€ WizardContainer.tsx    # Main wizard wrapper
```

## Key Takeaways

<Callout type="success">
  **Best Practices Demonstrated:**
  - Use `canEnter` guards for access control
  - Update context in `beforeExit` to share data between steps
  - Extract navigation logic to separate functions for testability
  - Compute available steps dynamically based on context
  - Show only relevant steps in UI based on user role
</Callout>

## Use Cases

This pattern is ideal for:
- **Multi-tenant applications** with different user types
- **Approval workflows** requiring manager sign-off
- **Onboarding flows** with role-specific steps
- **Survey/form builders** with conditional questions
- **E-commerce checkouts** with business vs personal accounts

## Technologies Used

- React 18
- TypeScript
- @wizard/core & @wizard/react
- Tailwind CSS
- Vite

## Next Steps

- Explore [TanStack Router Integration](/examples/react-router) for URL-synced wizards
- Learn about [Form Validation](/examples/zod-validation) with Zod schemas
- See [Local Persistence](/examples/persistence-local) for auto-save functionality

## Source Code

[View full source on GitHub â†’](https://github.com/user/wizard/tree/main/examples/advanced-branching)
