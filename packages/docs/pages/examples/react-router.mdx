# TanStack Router Integration Example

import { Callout } from '../../components'

A comprehensive example demonstrating TanStack Router integration with automatic URL syncing, bookmarkable wizard steps, and route-based navigation.

## Overview

This example shows how to build wizards with:
- **Automatic URL syncing** - Steps reflected in browser URL
- **Bookmarkable steps** - Users can bookmark and share step URLs
- **Route guards** - Validate step access via URL
- **Browser history integration** - Back/forward buttons work
- **Deep linking** - Direct navigation to specific steps

## What You'll Learn

<div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '1rem', marginTop: '1.5rem' }}>
  <div style={{ padding: '1rem', border: '1px solid var(--gray-300)', borderRadius: '8px' }}>
    <div style={{ fontWeight: 600, marginBottom: '0.5rem' }}>🔗 URL Syncing</div>
    <div style={{ fontSize: '0.9rem', opacity: 0.8 }}>Automatically sync wizard state with URL</div>
  </div>
  <div style={{ padding: '1rem', border: '1px solid var(--gray-300)', borderRadius: '8px' }}>
    <div style={{ fontWeight: 600, marginBottom: '0.5rem' }}>📑 Bookmarking</div>
    <div style={{ fontSize: '0.9rem', opacity: 0.8 }}>Create shareable links to specific steps</div>
  </div>
  <div style={{ padding: '1rem', border: '1px solid var(--gray-300)', borderRadius: '8px' }}>
    <div style={{ fontWeight: 600, marginBottom: '0.5rem' }}>🛡️ Route Guards</div>
    <div style={{ fontSize: '0.9rem', opacity: 0.8 }}>Protect wizard steps with validation</div>
  </div>
</div>

## URL Structure

The wizard creates clean, readable URLs for each step:

```
/checkout/account      → Account information step
/checkout/shipping     → Shipping details step
/checkout/payment      → Payment information step
/checkout/review       → Order review step
```

## Key Implementation

### Simplified TanStack Router Integration

The `@wizard/react` package provides a streamlined integration:

```tsx
import { createWizardRouteComponent } from '@wizard/react';
import { createRouter, createRoute, createRootRoute } from '@tanstack/react-router';
import { wizard } from './wizard/config';

// Create a wizard route component - it handles everything!
const WizardRoute = createWizardRouteComponent({
  wizard,
  basePath: '/checkout'
});

// Set up routes
const rootRoute = createRootRoute();

const checkoutRoute = createRoute({
  getParentRoute: () => rootRoute,
  path: '/checkout',
  component: WizardRoute
});

const router = createRouter({
  routeTree: rootRoute.addChildren([checkoutRoute])
});

// That's it! The wizard now:
// ✅ Syncs step with URL automatically
// ✅ Updates URL on navigation
// ✅ Restores step from URL on page load
// ✅ Validates step exists before navigating
// ✅ Handles browser back/forward buttons
```

### Wizard Configuration

```typescript
import { wizardWithContext, step } from '@wizard/core';

interface CheckoutContext {
  total: number;
  currency: string;
  customerId: string | null;
}

const { defineSteps, createWizard } = wizardWithContext<CheckoutContext>({
  total: 0,
  currency: 'USD',
  customerId: null
});

const steps = defineSteps({
  account: step({
    data: {
      email: '',
      password: '',
      name: ''
    },
    validate: async ({ data }) => {
      if (!data.email || !data.password) {
        throw new Error('Email and password are required');
      }
    },
    beforeExit: ({ data, updateContext }) => {
      // Store customer ID in context
      updateContext(ctx => ({
        ...ctx,
        customerId: data.email
      }));
    },
    next: ['shipping']
  }),

  shipping: step({
    data: {
      address: '',
      city: '',
      state: '',
      zip: ''
    },
    canEnter: ({ context }) => {
      // Must have customer ID to access shipping
      return !!context.customerId;
    },
    validate: async ({ data }) => {
      if (!data.address || !data.city) {
        throw new Error('Address and city are required');
      }
    },
    next: ['payment']
  }),

  payment: step({
    data: {
      cardNumber: '',
      expiry: '',
      cvv: ''
    },
    canEnter: ({ context, wizard }) => {
      // Must have shipping info
      const shipping = wizard.getStep('shipping').data;
      return !!shipping && !!shipping.address;
    },
    validate: async ({ data }) => {
      if (!data.cardNumber || !data.cvv) {
        throw new Error('Card number and CVV are required');
      }
    },
    beforeExit: ({ context, wizard, updateContext }) => {
      // Calculate total
      const total = 99.99; // Example calculation
      updateContext(ctx => ({ ...ctx, total }));
    },
    next: ['review']
  }),

  review: step({
    data: {
      confirmed: false
    },
    canEnter: ({ context }) => {
      // Must have a total to review
      return context.total > 0;
    },
    validate: async ({ data }) => {
      if (!data.confirmed) {
        throw new Error('You must confirm the order');
      }
    },
    next: []
  })
});

export const wizard = createWizard(steps);
```

### Advanced: Custom Route Configuration

For more control, you can manually configure routes:

```tsx
import { useNavigate, useParams } from '@tanstack/react-router';
import { useWizard, WizardProvider } from '@wizard/react';
import { useEffect } from 'react';
import { wizard } from './wizard/config';

function CheckoutPage() {
  return (
    <WizardProvider wizard={wizard}>
      <WizardWithRouter />
    </WizardProvider>
  );
}

function WizardWithRouter() {
  const navigate = useNavigate();
  const params = useParams({ from: '/checkout/$step' });
  const wizardInstance = useWizard();

  // Sync URL step to wizard
  useEffect(() => {
    const urlStep = params.step;
    const currentStep = wizardInstance.state.currentStep;

    if (urlStep && urlStep !== currentStep) {
      // Validate step exists
      const stepDef = wizardInstance.getStep(urlStep);
      if (stepDef) {
        wizardInstance.goTo(urlStep).catch(() => {
          // Step guard failed, redirect to current step
          navigate({ to: `/checkout/${currentStep}` });
        });
      } else {
        // Invalid step, redirect to first step
        navigate({ to: '/checkout/account' });
      }
    }
  }, [params.step]);

  // Sync wizard step to URL
  useEffect(() => {
    const unsubscribe = wizardInstance.subscribe(state => {
      const urlStep = params.step;
      if (state.currentStep !== urlStep) {
        navigate({
          to: `/checkout/${state.currentStep}`,
          // Preserve query params and other state
          replace: false
        });
      }
    });

    return unsubscribe;
  }, [wizardInstance, navigate]);

  return <WizardSteps />;
}

function WizardSteps() {
  const { state } = useWizardState();

  return (
    <div>
      {state.currentStep === 'account' && <AccountStep />}
      {state.currentStep === 'shipping' && <ShippingStep />}
      {state.currentStep === 'payment' && <PaymentStep />}
      {state.currentStep === 'review' && <ReviewStep />}
    </div>
  );
}
```

### Route Guards and Validation

```tsx
import { createRoute } from '@tanstack/react-router';
import { wizard } from './wizard/config';

const checkoutRoute = createRoute({
  path: '/checkout/$step',
  component: CheckoutPage,
  beforeLoad: async ({ params }) => {
    const step = params.step;

    // Check if step exists
    const stepDef = wizard.getStep(step);
    if (!stepDef) {
      throw redirect({ to: '/checkout/account' });
    }

    // Check if user can enter this step
    const canEnter = await wizard.helpers.canGoTo(step);
    if (!canEnter) {
      // Redirect to first accessible step
      const currentStep = wizard.state.currentStep;
      throw redirect({ to: `/checkout/${currentStep}` });
    }
  }
});
```

### Component with Navigation

```tsx
function AccountStep() {
  const wizard = useWizard();
  const navigate = useNavigate();

  const [formData, setFormData] = useState({
    email: '',
    password: '',
    name: ''
  });

  const handleNext = async () => {
    try {
      // Set step data
      wizard.setStepData('account', formData);

      // Navigate to next step
      await wizard.next();

      // URL will automatically update to /checkout/shipping
    } catch (error) {
      alert(error.message);
    }
  };

  const handleBack = () => {
    // Use browser back or wizard back
    navigate({ to: '/checkout' });
  };

  return (
    <div>
      <h2>Account Information</h2>

      <input
        type="email"
        placeholder="Email"
        value={formData.email}
        onChange={(e) => setFormData({ ...formData, email: e.target.value })}
      />

      <input
        type="password"
        placeholder="Password"
        value={formData.password}
        onChange={(e) => setFormData({ ...formData, password: e.target.value })}
      />

      <input
        type="text"
        placeholder="Full Name"
        value={formData.name}
        onChange={(e) => setFormData({ ...formData, name: e.target.value })}
      />

      <div className="navigation">
        <button onClick={handleBack}>Back</button>
        <button onClick={handleNext}>Next</button>
      </div>
    </div>
  );
}
```

## Running the Example

```bash
# From repository root
cd examples/react-router-wizard

# Install dependencies
pnpm install

# Start development server
pnpm dev

# Build for production
pnpm build
```

## Project Structure

```
src/
├── App.tsx                    # Router setup
├── wizard/
│   ├── config.ts              # Wizard configuration
│   ├── factory.ts             # Wizard factory
│   └── types.ts               # TypeScript types
├── components/
│   ├── AccountStep.tsx        # Account form
│   ├── ShippingStep.tsx       # Shipping form
│   ├── PaymentStep.tsx        # Payment form
│   ├── ReviewStep.tsx         # Review & confirm
│   ├── StepIndicator.tsx      # Visual step progress
│   └── ui/
│       ├── Button.tsx         # Styled button
│       └── FormField.tsx      # Form input
└── routes/
    └── checkout.tsx           # Checkout route config
```

## Features Demonstrated

### URL Syncing
Wizard step automatically reflects in the URL and vice versa.

### Deep Linking
Users can navigate directly to `/checkout/payment` if they have access.

### Browser Integration
Back/forward buttons navigate through wizard steps.

### Route Guards
`canEnter` guards prevent unauthorized step access via URL.

### Query Parameters
Preserve query params across wizard navigation.

## Key Takeaways

<Callout type="success">
  **Best Practices Demonstrated:**
  - Use `createWizardRouteComponent` for simple setup
  - Implement `canEnter` guards for step protection
  - Sync wizard state bidirectionally with URL
  - Handle invalid step URLs gracefully
  - Preserve wizard data across page refreshes (combine with persistence)
  - Use clean, readable URL patterns
</Callout>

## Use Cases

This pattern is ideal for:
- **E-commerce checkouts** with shareable cart states
- **Multi-step forms** that users may revisit
- **Onboarding flows** with bookmarkable progress
- **Survey builders** with direct step access
- **Application wizards** requiring URL-based navigation

## Browser Features

### Bookmarking
Users can bookmark specific wizard steps and return directly to them.

### Sharing
Share wizard URLs with specific steps and data (combine with query params).

### History
Use browser back/forward to navigate between wizard steps.

### Refresh
Page refreshes maintain wizard step position.

## Technologies Used

- React 18
- TypeScript
- @wizard/core & @wizard/react
- TanStack Router ^1.0
- Tailwind CSS
- Vite

## Next Steps

- Combine with [Local Persistence](/examples/persistence-local) for full state recovery
- Add [Zod Validation](/examples/zod-validation) for robust form validation
- Explore [Advanced Branching](/examples/advanced-branching) for dynamic routing

## Source Code

[View full source on GitHub →](https://github.com/user/wizard/tree/main/examples/react-router-wizard)
